<!DOCTYPE html>
<html lang="zh-hant-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Q&A表單管理</title>

    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">

		<style>
		
		body {
		    font-family: Arial, sans-serif;
		    margin: 20px;
		}
		
		table {
		    width: 100%;
		    border-collapse: collapse;
		    margin-top: 20px;
		}
		
		th, td {
		    border: 1px solid #ddd;
		    padding: 8px;
		    text-align: left;
		}
		
		th {
		    background-color: #f2f2f2;
		}
		
		.header-btn {
		    background-color: #ffc107;
		    color: black;
		    border-radius: 0.25rem;
		}
		
		.header-btn:hover {
		    background-color: #e0a800;
		}
		
		input[type="text"], textarea {
		    width: 100%;
		    border: 1px solid #ced4da;
		    border-radius: 0.25rem;
		    padding: 5px;
		}
		
		input[type="text"]:focus, textarea:focus {
		    border-color: #80bdff;
		    outline: none;
		}
		
		button {
		    background-color: #007bff;
		    color: white;
		    border: none;
		    border-radius: 0.25rem;
		    padding: 8px 12px;
		    cursor: pointer;
		}
		
		button:hover {
		    background-color: #0056b3;
		}
		</style>

	</head>
	<body>
	
	    <div th:replace="~{Customer_Service/html/saHeader}"></div>
	
		<h1 class="text-center">
	    	<span class="btn header-btn" style="font-size: 25px;">Q&A表單管理</span>
		</h1>
	
	  	<div class="container mt-4">
        	<h2>查詢列表</h2>
        	<div class="mb-4" style="display: flex; gap: 10px; align-items: center;">
	            <label for="searchInput" style="flex-shrink: 0;">搜尋表單:</label>
	            <input type="text" id="searchInput" class="form-control" style="flex-grow: 1;" placeholder="可輸入表單ID、問題分類、問題標題、問題內容來查詢">
	            <button class="btn btn-primary" onclick="searchReview()" style="flex-shrink: 0;flex-grow: 1;">搜尋</button>
        	</div>
        
      		<!-- 表單內容 -->  
			<div class="mb-4">
            	<h2>表單列表</h2>
            	<button type="button" class="btn btn-primary" id="new" data-bs-toggle="modal" data-bs-target="#addModal">新增</button>
            	<table id="faTable" class="table table-striped">
	    			<thead>
				        <tr>
				        	<th>Q&A編號</th>
				            <th>分類</th>
				            <th>標題</th>
				            <th>內容</th>
				            <th>更新時間</th>
				            <th>上架狀態</th>
				            <th>修改</th>
				        </tr>
				    </thead>
	            <tbody id="qaTable">
			   		<!-- 資料將通過 JavaScript 動態插入 -->
				</tbody>

	        	</table>
	    	</div>
    		</div>
    		
    	<!-- 新增 彈出框 -->
	    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="addModalLabel">新增 Q&A</h5>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <form id="addForm">
		                    <div class="mb-3">
		                        <label for="formSort" class="form-label">分類</label>
		                        <select class="form-select" id="formSort" required>
		                            <option value="帳號相關">帳號相關</option>
		                            <option value="平台守則">平台守則</option>
		                            <option value="買家相關">買家相關</option>
		                            <option value="賣家相關">賣家相關</option>
		                            <option value="其他問題">其他問題</option>
		                        </select>
		                    </div>
		                    <div class="mb-3">
		                        <label for="formTitle" class="form-label">標題</label>
		                        <input type="text" class="form-control" id="formTitle" required>
		                    </div>
		                    <div class="mb-3">
		                        <label for="formContent" class="form-label">內容</label>
		                        <textarea class="form-control" id="formContent" rows="3" required></textarea>
		                    </div>
		                </form>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
		                <button type="button" class="btn btn-primary" id="saveBtn">儲存</button>
		            </div>
		        </div>
		    </div>
		</div>

	    
	    <!-- 修改 彈出框 -->
		<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
		    <div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="editModalLabel">Q&A修改</h5>
		                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		                    <span aria-hidden="true">&times;</span>
		                </button>
		            </div>
		            <div class="modal-body">
		                <form id="editForm">
		                    <input type="hidden" id="editCSQADataId">
		                    <div class="form-group">
		                        <label for="editCSQADataSort">分類</label>
		                        <select class="form-control" id="editCSQADataSort">
		                            <option value="帳號相關">帳號相關</option>
		                            <option value="平台守則">平台守則</option>
		                            <option value="買家相關">買家相關</option>
		                            <option value="賣家相關">賣家相關</option>
		                            <option value="其他問題">其他問題</option>
		                        </select>
		                    </div>
		                    <div class="form-group">
		                        <label for="editCSQADataTitle">標題</label>
		                        <input type="text" class="form-control" id="editCSQADataTitle">
		                    </div>
		                    <div class="form-group">
		                        <label for="editCSQADataContent">內容</label>
		                        <textarea class="form-control" id="editCSQADataContent" rows="3"></textarea>
		                    </div>
		                    <div class="form-group">
		                        <label for="editCSQADataChack">狀態</label>
		                        <select class="form-control" id="editCSQADataChack">
		                            <option value="0">上架中</option>
		                            <option value="1">下架中</option>
		                        </select>
		                    </div>
		                </form>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
		                <button type="button" id="saveEditBtn" class="btn btn-primary">儲存</button>
		            </div>
		        </div>
		    </div>
		</div>


		<!-- script -->
	   	<script src="/js/bootstrap.bundle.min.js"></script>
	    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

		<script>
		// 定義 API 路徑
		const apiUrl = "http://localhost:8080/QA_manage/json";
		
		// 獲取資料並顯示於表格
		$(document).ready(function () {
	    	$.ajax({
	        url: apiUrl,
	        method: "GET",
	        success: function (data) {
	        let tableBody = $("#qaTable");
            // 清空表格內容
            tableBody.empty();

            // 遍歷資料並插入表格
            data.forEach(item => {                
                // 建立表格行
                const statusText = item.csqadataChack === 1 ? "上架中" : "下架中";
                const row = `
                    <tr>
                        <td>${item.csqadataId}</td>
                        <td>${item.csqadataSort}</td>
                        <td>${item.csqadataTitle}</td>
                        <td>${item.csqadataContent}</td>
                        <td>${item.csqadataDATE}</td>
                        <td>${statusText}</td>
                        <td>
                            <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#editModal" onclick="openEditModal(${item.cSqadataId})">修改</button>
                        </td>
                    </tr>
                `;
                tableBody.append(row); // 將行插入到表格中
			            });
			        }
			    });
			});
			
			// 開啟修改彈出框，並載入資料
            function openEditModal(CSQADataId) {
                $.ajax({
                    url: `/json/QADataId=${CSQADataId}`, // API 用於查詢指定 ID 的資料
                    method: "GET",
                    success: function (data) {
                        // 將資料填入彈出框中的輸入框
                        $("#editId").val(data.CSQADataId); // 隱藏的 ID 欄位
                        $("#editSort").val(data.CSQADataSort);
                        $("#editTitle").val(data.CSQADataTitle);
                        $("#editContent").val(data.CSQADataContent);
                        $("#editStatus").val(data.CSQADataChack);
                        $("#editModal").modal("show"); // 顯示彈出框
                    },
                    error: function () {
                        alert("無法載入資料，請稍後再試！");
                    }
                });
            }

			
			
	    
			// 儲存修改後的資料
			function saveEdit() {
			    const id = $("#editId").val();
			    const updatedData = {
			        csqadataSort: $("#editSort").val(),
			        csqadataTitle: $("#editTitle").val(),
			        csqadataContent: $("#editContent").val(),
			        csqadataChack: $("#editStatus").val()
			    };
			
			    $.ajax({
			        url: `${apiUrl}/${id}`, // 假設後端提供更新的 API
			        method: "PUT",
			        contentType: "application/json",
			        data: JSON.stringify(updatedData),
			        success: function () {
			            alert("修改成功！");
			            $("#editModal").modal("hide"); // 關閉彈出框
			            location.reload(); // 重新載入頁面
			        },
			        error: function () {
			            alert("儲存失敗，請稍後再試！");
			        }
			    });
			}
						
			//新增資料按鈕
			$('#addQAForm').submit(function(e) {
			    e.preventDefault();
			    var CSQADataSort = $('#CSQADataSort').val();
			    var CSQADataTitle = $('#CSQADataTitle').val();
			    var CSQADataContent = $('#CSQADataContent').val();
			    var CSQADataDATE = new Date().toISOString();  // 使用 ISO 格式時間
			
			    $.ajax({
			        url: '/form_manage/addQA',
			        type: 'POST',
			        data: {
			            CSQADataSort: CSQADataSort,
			            CSQADataTitle: CSQADataTitle,
			            CSQADataContent: CSQADataContent,
			            CSQADataDATE: CSQADataDATE
			        },
			        success: function(response) {
			            alert('新增成功！');
			            // 重新載入資料
			            loadData();
			        },
			        error: function() {
			            alert('新增資料失敗，請稍後再試！');
			        }
			    });
			});
			
			
	    
	    </script>

</body>
</html>
